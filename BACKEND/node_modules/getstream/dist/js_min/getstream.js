!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.stream=e():t.stream=e()}(window,function(){return function(n){var i={};function r(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}return r.m=n,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="dist/",r(r.s=86)}([function(t,e,n){"use strict";t.exports=function(t,e,n){if(!e)return t;for(var i in e)e.hasOwnProperty(i)&&(t.hasOwnProperty(i)&&!1===n||t[i]!==e[i]&&(t[i]=e[i]));return t}},function(t,e,n){"use strict";var r=n(0);t.exports=function(t,e){"function"!=typeof t&&(e=t,t=Object);var n=function(){return this.initialize&&this.initialize.apply(this,arguments)||this},i=function(){};return i.prototype=t.prototype,n.prototype=new i,r(n.prototype,e),n}},function(H,I){var J;J=function(){return this}();try{J=J||Function("return this")()||eval("this")}catch(t){"object"==typeof window&&(J=window)}H.exports=J},function(t,e,n){"use strict";t.exports={isURI:function(t){return t&&t.protocol&&t.host&&t.path},isSameOrigin:function(t){return t.protocol===location.protocol&&t.hostname===location.hostname&&t.port===location.port},parse:function(n){if("string"!=typeof n)return n;var t,e,i,r,s,o,a={},c=function(e,t){n=n.replace(t,function(t){return a[e]=t,""}),a[e]=a[e]||""};for(c("protocol",/^[a-z]+\:/i),c("host",/^\/\/[^\/\?#]+/),/^\//.test(n)||a.host||(n=location.pathname.replace(/[^\/]*$/,"")+n),c("pathname",/^[^\?#]*/),c("search",/^\?[^#]*/),c("hash",/^#.*/),a.protocol=a.protocol||location.protocol,a.host?(a.host=a.host.substr(2),t=a.host.split(":"),a.hostname=t[0],a.port=t[1]||""):(a.host=location.host,a.hostname=location.hostname,a.port=location.port),a.pathname=a.pathname||"/",a.path=a.pathname+a.search,o={},r=0,s=(i=(e=a.search.replace(/^\?/,""))?e.split("&"):[]).length;r<s;r++)t=i[r].split("="),o[decodeURIComponent(t[0]||"")]=decodeURIComponent(t[1]||"");return a.query=o,a.href=this.stringify(a),a},stringify:function(t){var e=t.protocol+"//"+t.hostname;return t.port&&(e+=":"+t.port),e+=t.pathname+this.queryString(t.query)+(t.hash||"")},queryString:function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return 0===e.length?"":"?"+e.join("&")}}},function(u,t,f){"use strict";(function(o){var t=f(1),a=f(26).Cookie,n=f(8),h=f(3),l=f(16),i=f(0),e=f(7),r=f(66),s=f(28),c=i(t({className:"Transport",DEFAULT_PORTS:{"http:":80,"https:":443,"ws:":80,"wss:":443},MAX_DELAY:0,batching:!0,initialize:function(t,e){this._dispatcher=t,this.endpoint=e,this._outbox=[],this._proxy=i({},this._dispatcher.proxy),this._proxy.origin||(this._proxy.origin=this._findProxy())},close:function(){},encode:function(t){return""},sendMessage:function(t){return this.debug("Client ? sending message to ?: ?",this._dispatcher.clientId,h.stringify(this.endpoint),t),this.batching?(this._outbox.push(t),this._flushLargeBatch(),t.channel===s.HANDSHAKE?this._publish(.01):(t.channel===s.CONNECT&&(this._connectMessage=t),this._publish(this.MAX_DELAY))):n.resolve(this.request([t]))},_makePromise:function(){var e=this;this._requestPromise=this._requestPromise||new n(function(t){e._resolvePromise=t})},_publish:function(t){return this._makePromise(),this.addTimeout("publish",t,function(){this._flush(),delete this._requestPromise},this),this._requestPromise},_flush:function(){this.removeTimeout("publish"),1<this._outbox.length&&this._connectMessage&&(this._connectMessage.advice={timeout:0}),this._resolvePromise(this.request(this._outbox)),this._connectMessage=null,this._outbox=[]},_flushLargeBatch:function(){if(!(this.encode(this._outbox).length<this._dispatcher.maxRequestSize)){var t=this._outbox.pop();this._makePromise(),this._flush(),t&&this._outbox.push(t)}},_receive:function(t){if(t){t=[].concat(t),this.debug("Client ? received from ? via ?: ?",this._dispatcher.clientId,h.stringify(this.endpoint),this.connectionType,t);for(var e=0,n=t.length;e<n;e++)this._dispatcher.handleResponse(t[e])}},_handleError:function(t,e){t=[].concat(t),this.debug("Client ? failed to send to ? via ?: ?",this._dispatcher.clientId,h.stringify(this.endpoint),this.connectionType,t);for(var n=0,i=t.length;n<i;n++)this._dispatcher.handleError(t[n])},_getCookies:function(){var t=this._dispatcher.cookies,e=h.stringify(this.endpoint);return t?l.map(t.getCookiesSync(e),function(t){return t.cookieString()}).join("; "):""},_storeCookies:function(t){var e,n=this._dispatcher.cookies,i=h.stringify(this.endpoint);if(t&&n)for(var r=0,s=(t=[].concat(t)).length;r<s;r++)e=a.parse(t[r]),n.setCookieSync(e,i)},_findProxy:function(){if(void 0!==o){var t=this.endpoint.protocol;if(t){var e,n,i=t.replace(/:$/,"").toLowerCase()+"_proxy",r=i.toUpperCase(),s=o.env;return"http_proxy"===i&&s.REQUEST_METHOD?(1===(e=Object.keys(s).filter(function(t){return/^http_proxy$/i.test(t)})).length?e[0]===i&&void 0===s[r]&&(n=s[i]):1<e.length&&(n=s[i]),n=n||s["CGI_"+r]):(n=s[i]||s[r])&&!s[i]&&console.warn("The environment variable "+r+" is discouraged. Use "+i+"."),n}}}}),{get:function(s,o,a,c,u){var t=s.endpoint;l.asyncEach(this._transports,function(t,n){var e=t[0],i=t[1],r=s.endpointFor(e);return 0<=l.indexOf(a,e)?n():l.indexOf(o,e)<0?(i.isUsable(s,r,function(){}),n()):void i.isUsable(s,r,function(t){if(!t)return n();var e=i.hasOwnProperty("create")?i.create(s,r):new i(s,r);c.call(u,e)})},function(){throw new Error("Could not find a usable connection type for "+h.stringify(t))})},register:function(t,e){this._transports.push([t,e]),e.prototype.connectionType=t},getConnectionTypes:function(){return l.map(this._transports,function(t){return t[0]})},_transports:[]});i(c.prototype,e),i(c.prototype,r),u.exports=c}).call(this,f(19))},function(t,e,n){"use strict";(function(i){var r=n(8);t.exports={then:function(t,e){var n=this;return this._promise||(this._promise=new r(function(t,e){n._resolve=t,n._reject=e})),0===arguments.length?this._promise:this._promise.then(t,e)},callback:function(e,n){return this.then(function(t){e.call(n,t)})},errback:function(e,n){return this.then(null,function(t){e.call(n,t)})},timeout:function(t,e){this.then();var n=this;this._timer=i.setTimeout(function(){n._reject(e)},1e3*t)},setDeferredStatus:function(t,e){this._timer&&i.clearTimeout(this._timer),this.then(),"succeeded"===t?this._resolve(e):"failed"===t?this._reject(e):delete this._promise}}}).call(this,n(2))},function(t,e,n){"use strict";t.exports=function(t){return JSON.stringify(t,function(t,e){return this[t]instanceof Array?this[t]:e})}},function(t,e,n){"use strict";var a=n(6),c={LOG_LEVELS:{fatal:4,error:3,warn:2,info:1,debug:0},writeLog:function(t,e){var n=c.logger||(c.wrapper||c).logger;if(n){var i=Array.prototype.slice.apply(t),r="[Faye",s=this.className,o=i.shift().replace(/\?/g,function(){try{return a(i.shift())}catch(t){return"[Object]"}});s&&(r+="."+s),r+="] ","function"==typeof n[e]?n[e](r+o):"function"==typeof n&&n(r+o)}}};for(var i in c.LOG_LEVELS)!function(t){c[t]=function(){this.writeLog(arguments,t)}}(i);t.exports=c},function(t,e,n){"use strict";var i=n(30),r=function(t){return t},s=function(t){throw t},o=function(t){if(this._state=0,this._onFulfilled=[],this._onRejected=[],"function"==typeof t){var e=this;t(function(t){l(e,t)},function(t){d(e,t)})}};o.prototype.then=function(t,e){var n=new o;return a(this,t,n),c(this,e,n),n},o.prototype.catch=function(t){return this.then(null,t)};var a=function(t,e,n){"function"!=typeof e&&(e=r);var i=function(t){u(e,t,n)};0===t._state?t._onFulfilled.push(i):1===t._state&&i(t._value)},c=function(t,e,n){"function"!=typeof e&&(e=s);var i=function(t){u(e,t,n)};0===t._state?t._onRejected.push(i):2===t._state&&i(t._reason)},u=function(t,e,n){i(function(){h(t,e,n)})},h=function(t,e,n){var i;try{i=t(e)}catch(t){return d(n,t)}i===n?d(n,new TypeError("Recursive promise chain detected")):l(n,i)},l=function(e,t){var n,i,r=!1;try{if(n=typeof t,"function"!=typeof(i=null!==t&&("function"===n||"object"===n)&&t.then))return f(e,t);i.call(t,function(t){r^(r=!0)&&l(e,t)},function(t){r^(r=!0)&&d(e,t)})}catch(t){if(!(r^(r=!0)))return;d(e,t)}},f=function(t,e){if(0===t._state){t._state=1,t._value=e,t._onRejected=[];for(var n,i=t._onFulfilled;n=i.shift();)n(e)}},d=function(t,e){if(0===t._state){t._state=2,t._reason=e,t._onFulfilled=[];for(var n,i=t._onRejected;n=i.shift();)n(e)}};o.resolve=function(n){return new o(function(t,e){t(n)})},o.reject=function(n){return new o(function(t,e){e(n)})},o.all=function(e){return new o(function(n,i){var t,r=[],s=e.length;if(0===s)return n(r);for(t=0;t<s;t++)!function(t,e){o.resolve(t).then(function(t){r[e]=t,0==--s&&n(r)},i)}(e[t],t)})},o.race=function(r){return new o(function(t,e){for(var n=0,i=r.length;n<i;n++)o.resolve(r[n]).then(t,e)})},o.deferred=o.pending=function(){var n={};return n.promise=new o(function(t,e){n.resolve=t,n.reject=e}),n},t.exports=o},function(t,e){var n=t.exports,i="function"==typeof Error.captureStackTrace,r=!!(new Error).stack;function s(t,e){this.message=t,Error.call(this,this.message),i?Error.captureStackTrace(this,e):this.stack=r?(new Error).stack:""}(n._Abstract=s).prototype=new Error,n.FeedError=function(t){s.call(this,t)},n.FeedError.prototype=new s,n.SiteError=function(t){s.call(this,t)},n.SiteError.prototype=new s,n.MissingSchemaError=function(t){s.call(this,t)},n.MissingSchemaError.prototype=new s,n.StreamApiError=function(t,e,n){this.error=e,this.response=n,s.call(this,t)},n.StreamApiError.prototype=new s},function(t,e){this&&this.fetch;var E,n=function(t){function e(){this.fetch=!1}return e.prototype=t,new e}("undefined"!=typeof self?self:this);E=n,function(a){var n="URLSearchParams"in E,i="Symbol"in E&&"iterator"in Symbol,c="FileReader"in E&&"Blob"in E&&function(){try{return new Blob,!0}catch(t){return!1}}(),r="FormData"in E,s="ArrayBuffer"in E;if(s)var e=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=ArrayBuffer.isView||function(t){return t&&-1<e.indexOf(Object.prototype.toString.call(t))};function u(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function h(t){return"string"!=typeof t&&(t=String(t)),t}function t(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return i&&(t[Symbol.iterator]=function(){return t}),t}function l(e){this.map={},e instanceof l?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function f(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function d(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function p(t){var e=new FileReader,n=d(e);return e.readAsArrayBuffer(t),n}function y(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(t){var e;(this._bodyInit=t)?"string"==typeof t?this._bodyText=t:c&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:r&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:n&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():s&&c&&(e=t)&&DataView.prototype.isPrototypeOf(e)?(this._bodyArrayBuffer=y(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(t)||o(t))?this._bodyArrayBuffer=y(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c&&(this.blob=function(){var t=f(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var t,e,n,i=f(this);if(i)return i;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=d(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),i=0;i<e.length;i++)n[i]=String.fromCharCode(e[i]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}l.prototype.append=function(t,e){t=u(t),e=h(e);var n=this.map[t];this.map[t]=n?n+", "+e:e},l.prototype.delete=function(t){delete this.map[u(t)]},l.prototype.get=function(t){return t=u(t),this.has(t)?this.map[t]:null},l.prototype.has=function(t){return this.map.hasOwnProperty(u(t))},l.prototype.set=function(t,e){this.map[u(t)]=h(e)},l.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},l.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),t(n)},l.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),t(e)},l.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),t(n)},i&&(l.prototype[Symbol.iterator]=l.prototype.entries);var g=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function _(t,e){var n,i,r=(e=e||{}).body;if(t instanceof _){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new l(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,r||null==t._bodyInit||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new l(e.headers)),this.method=(n=e.method||this.method||"GET",i=n.toUpperCase(),-1<g.indexOf(i)?i:n),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function m(t){var r=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),i=e.join("=").replace(/\+/g," ");r.append(decodeURIComponent(n),decodeURIComponent(i))}}),r}function b(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new l(e.headers),this.url=e.url||"",this._initBody(t)}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})},v.call(_.prototype),v.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},b.error=function(){var t=new b(null,{status:0,statusText:""});return t.type="error",t};var w=[301,302,303,307,308];b.redirect=function(t,e){if(-1===w.indexOf(e))throw new RangeError("Invalid status code");return new b(null,{status:e,headers:{location:t}})},a.DOMException=E.DOMException;try{new a.DOMException}catch(t){a.DOMException=function(t,e){this.message=t,this.name=e;var n=Error(t);this.stack=n.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function T(r,o){return new Promise(function(i,t){var e=new _(r,o);if(e.signal&&e.signal.aborted)return t(new a.DOMException("Aborted","AbortError"));var s=new XMLHttpRequest;function n(){s.abort()}s.onload=function(){var t,r,e={status:s.status,statusText:s.statusText,headers:(t=s.getAllResponseHeaders()||"",r=new l,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var i=e.join(":").trim();r.append(n,i)}}),r)};e.url="responseURL"in s?s.responseURL:e.headers.get("X-Request-URL");var n="response"in s?s.response:s.responseText;i(new b(n,e))},s.onerror=function(){t(new TypeError("Network request failed"))},s.ontimeout=function(){t(new TypeError("Network request failed"))},s.onabort=function(){t(new a.DOMException("Aborted","AbortError"))},s.open(e.method,e.url,!0),"include"===e.credentials?s.withCredentials=!0:"omit"===e.credentials&&(s.withCredentials=!1),"responseType"in s&&c&&(s.responseType="blob"),e.headers.forEach(function(t,e){s.setRequestHeader(e,t)}),e.signal&&(e.signal.addEventListener("abort",n),s.onreadystatechange=function(){4===s.readyState&&e.signal.removeEventListener("abort",n)}),s.send(void 0===e._bodyInit?null:e._bodyInit)})}T.polyfill=!0,E.fetch||(E.fetch=T,E.Headers=l,E.Request=_,E.Response=b),a.Headers=l,a.Request=_,a.Response=b,a.fetch=T}({}),delete n.fetch.polyfill,t.exports=e=n.fetch,e.fetch=n.fetch,e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response,e.default=n.fetch},function(t,e,n){var i=n(18),r=n(9),s=/^[\w]+$/,o=/^[\w-]+$/;function a(t){if(!s.test(t))throw new r.FeedError("Invalid feedSlug, please use letters, numbers or _: "+t);return t}function c(t){if(!o.test(t))throw new r.FeedError("Invalid userId, please use letters, numbers, - or _: "+t);return t}e.validateFeedId=function(t){var e=t.split(":");if(2!==e.length)throw new r.FeedError("Invalid feedId, expected something like user:1 got "+t);var n=e[0],i=e[1];return a(n),c(i),t},e.validateFeedSlug=a,e.validateUserId=c,e.rfc3986=function(t){return t.replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})},e.isReadableStream=function(t){return"object"===i(t)&&i("function"===t._read)&&i("object"===t._readableState)}},function(t,e){function n(){return t.exports=n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},n.apply(this,arguments)}t.exports=n},function(t,e,n){"use strict";var r=function(t){var e,n,i;if(t instanceof Array){for(e=[],n=t.length;n--;)e[n]=r(t[n]);return e}if("object"!=typeof t)return t;for(i in e=null===t?null:{},t)e[i]=r(t[i]);return e};t.exports=r},function(t,e,n){"use strict";var i={countListeners:function(t){return this.listeners(t).length},bind:function(t,e,n){var i=Array.prototype.slice,r=function(){e.apply(n,i.call(arguments))};return this._listeners=this._listeners||[],this._listeners.push([t,e,n,r]),this.on(t,r)},unbind:function(t,e,n){this._listeners=this._listeners||[];for(var i,r=this._listeners.length;r--;)(i=this._listeners[r])[0]===t&&(!e||i[1]===e&&i[2]===n)&&(this._listeners.splice(r,1),this.removeListener(t,i[3]))}};n(0)(i,n(69).prototype),i.trigger=i.emit,t.exports=i},function(n,t,e){"use strict";(function(t){var e={_registry:[],on:function(t,e,n,i){var r=function(){n.call(i)};t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent("on"+e,r),this._registry.push({_element:t,_type:e,_callback:n,_context:i,_handler:r})},detach:function(t,e,n,i){for(var r,s=this._registry.length;s--;)r=this._registry[s],t&&t!==r._element||e&&e!==r._type||n&&n!==r._callback||i&&i!==r._context||(r._element.removeEventListener?r._element.removeEventListener(r._type,r._handler,!1):r._element.detachEvent("on"+r._type,r._handler),this._registry.splice(s,1),r=null)}};void 0!==t.onunload&&e.on(t,"unload",e.detach,e),n.exports={Event:e}}).call(this,e(2))},function(t,e,n){"use strict";t.exports={commonElement:function(t,e){for(var n=0,i=t.length;n<i;n++)if(-1!==this.indexOf(e,t[n]))return t[n];return null},indexOf:function(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return n;return-1},map:function(t,e,n){if(t.map)return t.map(e,n);var i=[];if(t instanceof Array)for(var r=0,s=t.length;r<s;r++)i.push(e.call(n||null,t[r],r));else for(var o in t)t.hasOwnProperty(o)&&i.push(e.call(n||null,o,t[o]));return i},filter:function(t,e,n){if(t.filter)return t.filter(e,n);for(var i=[],r=0,s=t.length;r<s;r++)e.call(n||null,t[r],r)&&i.push(t[r]);return i},asyncEach:function(t,e,n,i){var r=t.length,s=-1,o=0,a=!1,c=function(){if(o-=1,(s+=1)===r)return n&&n.call(i);e(t[s],u)},u=function(){o+=1,function(){if(!a){for(a=!0;0<o;)c();a=!1}}()};u()}}},function(t,e,n){var o=n(12),a=n(31),i=n(18),r=n(80),c=n(79),s=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/,u=n(78);function h(t){try{return u.atob(function(t){var e=t.length%4;if(!e)return t;for(var n=4-e;n--;)t+="=";return t}(t).replace(/\-/g,"+").replace(/_/g,"/"))}catch(t){if("InvalidCharacterError"===t.name)return;throw t}}function l(t){return function(t){if("object"===i(t))return t;try{return JSON.parse(t)}catch(t){return}}(h(t.split(".",1)[0]))}e.headerFromJWS=l,e.sign=function(t,e){var n=new r.createHash("sha1").update(t).digest(),i=r.createHmac("sha1",n).update(e).digest("base64");return i.replace(/\+/g,"-").replace(/\//g,"_").replace(/^=+/,"").replace(/=+$/,"")},e.JWTScopeToken=function(t,e,n,i){var r=i||{},s=!r.expireTokens||!r.expireTokens,o={resource:e,action:n};return r.feedId&&(o.feed_id=r.feedId),r.userId&&(o.user_id=r.userId),c.sign(o,t,{algorithm:"HS256",noTimestamp:s})},e.JWTUserSessionToken=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if("string"!=typeof e)throw new TypeError("userId should be a string");var r=a({user_id:e},n),s=o({algorithm:"HS256",noTimestamp:!0},i);return c.sign(r,t,s)},e.isJWTSignature=function(t){var e=t.split(" ")[1]||t;return s.test(e)&&!!l(e)}},function(e,t){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=i=function(t){return n(t)}:e.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":n(t)},i(t)}e.exports=i},function(t,e){var n,i,r=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(t){i=o}}();var c,u=[],h=!1,l=-1;function f(){h&&c&&(h=!1,c.length?u=c.concat(u):l=-1,u.length&&d())}function d(){if(!h){var t=a(f);h=!0;for(var e=u.length;e;){for(c=u,u=[];++l<e;)c&&c[l].run();l=-1,e=u.length}c=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function y(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new p(t,e)),1!==u.length||h||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=y,r.addListener=y,r.once=y,r.off=y,r.removeListener=y,r.removeAllListeners=y,r.emit=y,r.prependListener=y,r.prependOnceListener=y,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,n){var i=n(41).Symbol;t.exports=i},function(t,e){t.exports="object"==typeof self?self.FormData:window.FormData},function(t,e,n){var i=n(12),r=n(31),s=n(34),o=n(32),a=n(54),c=n(53),u=n(48),h=n(47),l=n(46),f=n(45),d=n(44),p=n(43);function y(){var t=arguments[3]||{},e="cloud";t.location&&(e=t.location+"-cloud"),t=r({},t,{location:e}),s.apply(this,[arguments[0],arguments[1],arguments[2],t])}function v(t){function e(){}return e.prototype=t,new e}function g(){o.apply(this,arguments)}function _(t){var e=t;if(Array.isArray(t))e=t.map(function(t){return _(t)});else if(p(t))for(var n in e={},t)e[n]=_(t[n]);else d(t)&&void 0!==t._streamRef&&(e=t._streamRef());return e}(y.prototype=v(s.prototype)).storage=function(t,e){return new a(this,t,e)},y.prototype.collection=function(t,e){return new a(this,t,e)},y.prototype.files=function(t){return new h(this,t)},y.prototype.images=function(t){return new l(this,t)},y.prototype.reactions=function(t){return new u(this,t)},y.prototype.permissions=function(t){return new f(this,t)},y.prototype.createUserSession=function(t,e){return new c(this,t,e)},y.prototype.feed=function(t,e,n){return new g(this,t,e,n)},(g.prototype=v(o.prototype)).get=function(t,e){return t&&t.mark_read&&t.mark_read.join&&(t.mark_read=t.mark_read.join(",")),t&&t.mark_seen&&t.mark_seen.join&&(t.mark_seen=t.mark_seen.join(",")),this.client.get({url:"enrich/feed/"+this.feedUrl+"/",qs:t,signature:this.signature},e)},g.prototype._addActivityOriginal=g.prototype.addActivity,g.prototype.addActivity=function(t,e){return t=_(t),this._addActivityOriginal(t,e)},g.prototype._addActivitiesOriginal=g.prototype.addActivities,g.prototype.addActivities=function(t,e){return t=_(t),this._addActivitiesOriginal(t,e)},g.prototype.getActivityDetail=function(t,e,n){return this.get(i({id_lte:t,id_gte:t,limit:1},e),n)},t.exports.StreamCloudClient=y,t.exports.StreamCloudFeed=g},function(t,e,n){"use strict";var i=function(t,e){this.message=t,this.options=e,this.attempts=0};n(0)(i.prototype,{getTimeout:function(){return this.options.timeout},getInterval:function(){return this.options.interval},isDeliverable:function(){var t=this.options.attempts,e=this.attempts,n=this.options.deadline,i=(new Date).getTime();return!(void 0!==t&&t<=e)&&!(void 0!==n&&n<i)},send:function(){this.attempts+=1},succeed:function(){},fail:function(){},abort:function(){}}),t.exports=i},function(r,t,o){"use strict";(function(c){var t=o(1),s=o(3),u=o(15),e=o(0),n=o(6),i=e(t(o(4),{encode:function(t){return n(t)},request:function(r){var s,t=this.endpoint.href,o=this;if(c.XMLHttpRequest)s=new XMLHttpRequest;else{if(!c.ActiveXObject)return this._handleError(r);s=new ActiveXObject("Microsoft.XMLHTTP")}s.open("POST",t,!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Pragma","no-cache"),s.setRequestHeader("X-Requested-With","XMLHttpRequest");var e=this._dispatcher.headers;for(var n in e)e.hasOwnProperty(n)&&s.setRequestHeader(n,e[n]);var a=function(){s.abort()};return void 0!==c.onbeforeunload&&u.Event.on(c,"beforeunload",a),s.onreadystatechange=function(){if(s&&4===s.readyState){var t=null,e=s.status,n=s.responseText,i=200<=e&&e<300||304===e||1223===e;if(void 0!==c.onbeforeunload&&u.Event.detach(c,"beforeunload",a),s.onreadystatechange=function(){},s=null,!i)return o._handleError(r);try{t=JSON.parse(n)}catch(t){}t?o._receive(t):o._handleError(r)}},s.send(this.encode(r)),s}}),{isUsable:function(t,e,n,i){var r="ReactNative"===navigator.product||s.isSameOrigin(e);n.call(i,r)}});r.exports=i}).call(this,o(2))},function(t,e,n){"use strict";var i=n(1);t.exports=i({initialize:function(){this._index={}},add:function(t){var e=void 0!==t.id?t.id:t;return!this._index.hasOwnProperty(e)&&(this._index[e]=t,!0)},forEach:function(t,e){for(var n in this._index)this._index.hasOwnProperty(n)&&t.call(e,this._index[n])},isEmpty:function(){for(var t in this._index)if(this._index.hasOwnProperty(t))return!1;return!0},member:function(t){for(var e in this._index)if(this._index[e]===t)return!0;return!1},remove:function(t){var e=void 0!==t.id?t.id:t,n=this._index[e];return delete this._index[e],n},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}})},function(t,e,n){"use strict";t.exports={}},function(t,e,n){"use strict";t.exports={CHANNEL_NAME:/^\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,CHANNEL_PATTERN:/^(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*\/\*{1,2}$/,ERROR:/^([0-9][0-9][0-9]:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*|[0-9][0-9][0-9]::(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)$/,VERSION:/^([0-9])+(\.(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*)*$/}},function(t,e,n){"use strict";var i=n(1),r=n(0),s=n(14),o=n(27),a=i({initialize:function(t){this.id=this.name=t},push:function(t){this.trigger("message",t)},isUnused:function(){return 0===this.countListeners("message")}});r(a.prototype,s),r(a,{HANDSHAKE:"/meta/handshake",CONNECT:"/meta/connect",SUBSCRIBE:"/meta/subscribe",UNSUBSCRIBE:"/meta/unsubscribe",DISCONNECT:"/meta/disconnect",META:"meta",SERVICE:"service",expand:function(t){var e=this.parse(t),n=["/**",t],i=e.slice();i[i.length-1]="*",n.push(this.unparse(i));for(var r=1,s=e.length;r<s;r++)(i=e.slice(0,r)).push("**"),n.push(this.unparse(i));return n},isValid:function(t){return o.CHANNEL_NAME.test(t)||o.CHANNEL_PATTERN.test(t)},parse:function(t){return this.isValid(t)?t.split("/").slice(1):null},unparse:function(t){return"/"+t.join("/")},isMeta:function(t){var e=this.parse(t);return e?e[0]===this.META:null},isService:function(t){var e=this.parse(t);return e?e[0]===this.SERVICE:null},isSubscribable:function(t){return this.isValid(t)?!this.isMeta(t)&&!this.isService(t):null},Set:i({initialize:function(){this._channels={}},getKeys:function(){var t=[];for(var e in this._channels)t.push(e);return t},remove:function(t){delete this._channels[t]},hasSubscription:function(t){return this._channels.hasOwnProperty(t)},subscribe:function(t,e){for(var n,i=0,r=t.length;i<r;i++){n=t[i],(this._channels[n]=this._channels[n]||new a(n)).bind("message",e)}},unsubscribe:function(t,e){var n=this._channels[t];return!!n&&(n.unbind("message",e),!!n.isUnused()&&(this.remove(t),!0))},distributeMessage:function(t){for(var e=a.expand(t.channel),n=0,i=e.length;n<i;n++){var r=this._channels[e[n]];r&&r.trigger("message",t)}}})}),t.exports=a},function(t,e){t.exports={VERSION:"1.2.4",BAYEUX_VERSION:"1.0",ID_LENGTH:160,JSONP_CALLBACK:"jsonpcallback",CONNECTION_TYPES:["long-polling","cross-origin-long-polling","callback-polling","websocket","eventsource","in-process"],MANDATORY_CONNECTION_TYPES:["long-polling","callback-polling","in-process"]}},function(t,e,n){"use strict";var i=n(75),r=[],s=[],o=i.makeRequestCallFromTimer(function(){if(s.length)throw s.shift()});function a(t){var e;(e=r.length?r.pop():new c).task=t,i(e)}function c(){this.task=null}t.exports=a,c.prototype.call=function(){try{this.task.call()}catch(t){a.onerror?a.onerror(t):(s.push(t),o())}finally{this.task=null,r[r.length]=this}}},function(t,e,n){var r=n(81);t.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(t){r(e,t,n[t])})}return e}},function(t,e,n){var a=n(18),r=n(9),c=n(11),i=n(17),s=function(){this.initialize.apply(this,arguments)};s.prototype={initialize:function(t,e,n,i){if(!e||!n)throw new r.FeedError('Please provide a feed slug and user id, ie client.feed("user", "1")');if(-1!==e.indexOf(":"))throw new r.FeedError('Please initialize the feed using client.feed("user", "1") not client.feed("user:1")');if(c.validateFeedSlug(e),c.validateUserId(n),!this.apiSecret&&!i)throw new r.FeedError("Missing token, in client side mode please provide a feed secret");this.client=t,this.slug=e,this.userId=n,this.id=this.slug+":"+this.userId,this.token=i,this.feedUrl=this.id.replace(":","/"),this.feedTogether=this.id.replace(":",""),this.signature=this.feedTogether+" "+this.token,this.notificationChannel="site-"+this.client.appId+"-feed-"+this.feedTogether},addActivity:function(t,e){return t=this.client.signActivity(t),this.client.post({url:"feed/"+this.feedUrl+"/",body:t,signature:this.signature},e)},removeActivity:function(t,e){var n=t.foreignId?t.foreignId:t,i={};return t.foreignId&&(i.foreign_id="1"),this.client.delete({url:"feed/"+this.feedUrl+"/"+n+"/",qs:i,signature:this.signature},e)},addActivities:function(t,e){var n={activities:t=this.client.signActivities(t)};return this.client.post({url:"feed/"+this.feedUrl+"/",body:n,signature:this.signature},e)},follow:function(t,e,n,i){var r;c.validateFeedSlug(t),c.validateUserId(e);var s=arguments[arguments.length-1];i=s.call?s:void 0;var o=t+":"+e;n&&!n.call&&void 0!==n.limit&&null!==n.limit&&(r=n.limit);var a={target:o};return null!=r&&(a.activity_copy_limit=r),this.client.post({url:"feed/"+this.feedUrl+"/following/",body:a,signature:this.signature},i)},unfollow:function(t,e,n,i){var r={},s={};"function"==typeof n&&(i=n),"object"===a(n)&&(r=n),"boolean"==typeof r.keepHistory&&r.keepHistory&&(s.keep_history="1"),c.validateFeedSlug(t),c.validateUserId(e);var o=t+":"+e;return this.client.delete({url:"feed/"+this.feedUrl+"/following/"+o+"/",qs:s,signature:this.signature},i)},following:function(t,e){return void 0!==t&&t.filter&&(t.filter=t.filter.join(",")),this.client.get({url:"feed/"+this.feedUrl+"/following/",qs:t,signature:this.signature},e)},followers:function(t,e){return void 0!==t&&t.filter&&(t.filter=t.filter.join(",")),this.client.get({url:"feed/"+this.feedUrl+"/followers/",qs:t,signature:this.signature},e)},get:function(t,e){return t&&t.mark_read&&t.mark_read.join&&(t.mark_read=t.mark_read.join(",")),t&&t.mark_seen&&t.mark_seen.join&&(t.mark_seen=t.mark_seen.join(",")),this.client.get({url:"feed/"+this.feedUrl+"/",qs:t,signature:this.signature},e)},getFayeClient:function(){return this.client.getFayeClient()},subscribe:function(t){if(!this.client.appId)throw new r.SiteError("Missing app id, which is needed to subscribe, use var client = stream.connect(key, secret, appId);");var e=this.getFayeClient().subscribe("/"+this.notificationChannel,t);return this.client.subscriptions["/"+this.notificationChannel]={token:this.token,userId:this.notificationChannel,fayeSubscription:e},e},unsubscribe:function(){var t=this.client.subscriptions["/"+this.notificationChannel];t&&(delete this.client.subscriptions["/"+this.notificationChannel],t.fayeSubscription.cancel())},getReadOnlyToken:function(){var t=""+this.slug+this.userId;return i.JWTScopeToken(this.client.apiSecret,"*","read",{feedId:t,expireTokens:this.client.expireTokens})},getReadWriteToken:function(){var t=""+this.slug+this.userId;return i.JWTScopeToken(this.client.apiSecret,"*","*",{feedId:t,expireTokens:this.client.expireTokens})},updateActivityToTargets:function(t,e,n,i,r){if(!t)throw new Error("Missing `foreign_id` parameter!");if(!e)throw new Error("Missing `time` parameter!");if(!n&&!i&&!r)throw new Error('Requires you to provide at least one parameter for `new_targets`, `added_targets`, or `removed_targets` - example: `updateActivityToTargets("foreignID:1234", new Date(), [new_targets...], [added_targets...], [removed_targets...])`');if(n&&(i||r))throw new Error("Can't include add_targets or removed_targets if you're also including new_targets");if(i&&r)for(var s=0;s<i.length;s++)for(var o=0;o<r.length;o++)if(r[o]==i[s])throw new Error("Can't have the same feed ID in added_targets and removed_targets.");var a={foreign_id:t,time:e};return n&&(a.new_targets=n),i&&(a.added_targets=i),r&&(a.removed_targets=r),this.client.post({url:"feed_targets/"+this.feedUrl+"/activity_to_targets/",signature:this.signature,body:a})}},t.exports=s},function(t,e){var h=XMLHttpRequest;if(!h)throw new Error("missing XMLHttpRequest");l.log={trace:u,debug:u,info:u,warn:u,error:u};function l(t,e){if("function"!=typeof e)throw new Error("Bad callback given: "+e);if(!t)throw new Error("No options given");var n=t.onResponse;if((t="string"==typeof t?{uri:t}:JSON.parse(JSON.stringify(t))).onResponse=n,t.verbose&&(l.log=function(){var t,e,n={},i=["trace","debug","info","warn","error"];for(e=0;e<i.length;e++)n[t=i[e]]=u,"undefined"!=typeof console&&console&&console[t]&&(n[t]=d(console,t));return n}()),t.url&&(t.uri=t.url,delete t.url),!t.uri&&""!==t.uri)throw new Error("options.uri is a required argument");if("string"!=typeof t.uri)throw new Error("options.uri must be a string");for(var i=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],r=0;r<i.length;r++)if(t[i[r]])throw new Error("options."+i[r]+" is not supported");if(t.callback=e,t.method=t.method||"GET",t.headers=t.headers||{},t.body=t.body||null,t.timeout=t.timeout||l.DEFAULT_TIMEOUT,t.headers.host)throw new Error("Options.headers.host is not supported");t.json&&(t.headers.accept=t.headers.accept||"application/json","GET"!==t.method&&(t.headers["content-type"]="application/json"),"boolean"!=typeof t.json?t.body=JSON.stringify(t.json):"string"!=typeof t.body&&null!==t.body&&(t.body=JSON.stringify(t.body)));var s=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e.join("&")};if(t.qs){var o="string"==typeof t.qs?t.qs:s(t.qs);-1!==t.uri.indexOf("?")?t.uri=t.uri+"&"+o:t.uri=t.uri+"?"+o}if(t.form){if("string"==typeof t.form)throw"form name unsupported";if("POST"===t.method){var a=(t.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(t.headers["content-type"]=a){case"application/x-www-form-urlencoded":t.body=s(t.form).replace(/%20/g,"+");break;case"multipart/form-data":var c=function(t){var e={};e.boundry="-------------------------------"+Math.floor(1e9*Math.random());var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push("--"+e.boundry+'\nContent-Disposition: form-data; name="'+i+'"\n\n'+t[i]+"\n");return n.push("--"+e.boundry+"--"),e.body=n.join(""),e.length=e.body.length,e.type="multipart/form-data; boundary="+e.boundry,e}(t.form);t.body=c.body,t.headers["content-type"]=c.type;break;default:throw new Error("unsupported encoding:"+a)}}}return t.onResponse=t.onResponse||u,!0===t.onResponse&&(t.onResponse=e,t.callback=u),!t.headers.authorization&&t.auth&&(t.headers.authorization="Basic "+function(t){var e,n,i,r,s,o,a,c,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=0,l=0,f="",d=[];if(!t)return t;for(;e=t.charCodeAt(h++),n=t.charCodeAt(h++),i=t.charCodeAt(h++),r=(c=e<<16|n<<8|i)>>18&63,s=c>>12&63,o=c>>6&63,a=63&c,d[l++]=u.charAt(r)+u.charAt(s)+u.charAt(o)+u.charAt(a),h<t.length;);switch(f=d.join(""),t.length%3){case 1:f=f.slice(0,-2)+"==";break;case 2:f=f.slice(0,-1)+"="}return f}(t.auth.username+":"+t.auth.password)),function(e){var n=new h,i=!1,r=function(t){if(navigator&&"ReactNative"===navigator.product)return!1;var e,n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{e=location.href}catch(t){(e=document.createElement("a")).href="",e=e.href}var i=n.exec(e.toLowerCase())||[],r=n.exec(t.toLowerCase());return!(!r||r[1]==i[1]&&r[2]==i[2]&&(r[3]||("http:"===r[1]?80:443))==(i[3]||("http:"===i[1]?80:443)))}(e.uri),t="withCredentials"in n;if(f+=1,n.seq_id=f,n.id=f+": "+e.method+" "+e.uri,n._id=n.id,r&&!t){var s=new Error("Browser does not support cross-origin request: "+e.uri);return s.cors="unsupported",e.callback(s,n)}n.timeoutTimer=setTimeout(function(){i=!0;var t=new Error("ETIMEDOUT");return t.code="ETIMEDOUT",t.duration=e.timeout,l.log.error("Timeout",{id:n._id,milliseconds:e.timeout}),e.callback(t,n)},e.timeout);var o={response:!1,loading:!1,end:!1};n.onreadystatechange=function(t){if(i)return l.log.debug("Ignoring timed out state change",{state:n.readyState,id:n.id});l.log.debug("State change",{state:n.readyState,id:n.id,timed_out:i}),1===n.readyState?l.log.debug("Request started",{id:n.id}):2===n.readyState?c():3===n.readyState?(c(),u()):4===n.readyState&&(c(),u(),function(){if(!o.end){if(o.end=!0,l.log.debug("Request done",{id:n.id}),n.body=n.responseText,e.json)try{n.body=JSON.parse(n.responseText)}catch(t){return e.callback(t,n)}e.callback(null,n,n.body)}}())},n.open(e.method,e.uri,!0),r&&(n.withCredentials=!!e.withCredentials);for(var a in e.headers)n.setRequestHeader(a,e.headers[a]);return n.send(e.body),n;function c(){if(!o.response){if(o.response=!0,l.log.debug("Got response",{id:n.id,status:n.status}),clearTimeout(n.timeoutTimer),n.statusCode=n.status,r&&0==n.statusCode){var t=new Error("CORS request rejected: "+e.uri);return t.cors="rejected",o.loading=!0,o.end=!0,e.callback(t,n)}e.onResponse(null,n)}}function u(){o.loading||(o.loading=!0,l.log.debug("Response body loading",{id:n.id}))}}(t)}Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,i;if(null===this)throw new TypeError(" this is null or not defined");var r=Object(this),s=r.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(1<arguments.length&&(n=e),i=0;i<s;){var o;i in r&&(o=r[i],t.call(n,o,i,r)),i++}});var f=0;l.withCredentials=!1,l.DEFAULT_TIMEOUT=18e4,l.defaults=function(r,t){var e=function(i){return function(t,e){for(var n in t="string"==typeof t?{uri:t}:JSON.parse(JSON.stringify(t)),r)void 0===t[n]&&(t[n]=r[n]);return i(t,e)}},n=e(l);return n.get=e(l.get),n.post=e(l.post),n.put=e(l.put),n.head=e(l.head),n};function u(){}function d(n,i){return function(t,e){"object"==typeof e&&(t+=" "+JSON.stringify(e));return n[i].call(n,t)}}["get","put","post","head"].forEach(function(t){var n=t.toUpperCase();l[t.toLowerCase()]=function(t){"string"==typeof t?t={method:n,uri:t}:(t=JSON.parse(JSON.stringify(t))).method=n;var e=[t].concat(Array.prototype.slice.apply(arguments,[1]));return l.apply(this,e)}}),l.couch=function(t,r){return"string"==typeof t&&(t={uri:t}),t.json=!0,t.body&&(t.json=t.body),delete t.body,r=r||u,l(t,function(t,e,n){if(t)return r(t,e,n);if((e.statusCode<200||299<e.statusCode)&&n.error){for(var i in t=new Error("CouchDB error: "+(n.error.reason||n.error.error)),n)t[i]=n[i];return r(t,e,n)}return r(t,e,n)})},t.exports=l},function(s,t,_){(function(c){var l=_(12),u=_(83),h=_(82),f=_(33),a=_(32),d=_(17),p=_(9),y=_(11),t=_(77),e=_(76),v=_(74),g=_(73),n=_(72),i=function(){this.initialize.apply(this,arguments)};if(i.prototype={baseUrl:"https://api.stream-io-api.com/api/",baseAnalyticsUrl:"https://analytics.stream-io-api.com/analytics/",initialize:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(this.apiKey=t,this.apiSecret=e,this.appId=n,this.options=i,this.version=this.options.version||"v1.0",this.fayeUrl=this.options.fayeUrl||"https://faye.getstream.io/faye",this.fayeClient=null,this.request=f,this.group=this.options.group||"unspecified",this.subscriptions={},this.expireTokens=!!this.options.expireTokens&&this.options.expireTokens,this.location=this.options.location,this.baseUrl=this.getBaseUrl(),void 0!==c&&c.env.LOCAL_FAYE&&(this.fayeUrl="http://localhost:9999/faye/"),void 0!==c&&c.env.STREAM_ANALYTICS_BASE_URL&&(this.baseAnalyticsUrl=c.env.STREAM_ANALYTICS_BASE_URL),this.handlers={},this.browser=void 0!==this.options.browser?this.options.browser:"undefined"!=typeof window,this.node=!this.browser,!this.browser){var r=this.options.keepAlive;void 0===r&&(r=!0);var s=_(56),o=new(_(55).Agent)({keepAlive:r,keepAliveMsecs:3e3}),a=new s.Agent({keepAlive:r,keepAliveMsecs:3e3});this.requestAgent=this.baseUrl.startsWith("https://")?o:a}if(this.personalization=new h(this),this.collections=new u(this),this.browser&&this.apiSecret)throw new p.FeedError('You are publicly sharing your App Secret. Do not expose the App Secret in browsers, "native" mobile apps, or other non-trusted environments.')},getPersonalizationToken:function(){if(this._personalizationToken)return this._personalizationToken;if(!this.apiSecret)throw new p.SiteError("Missing secret, which is needed to perform signed requests, use var client = stream.connect(key, secret);");return this._personalizationToken=d.JWTScopeToken(this.apiSecret,"personalization","*",{userId:"*",feedId:"*",expireTokens:this.expireTokens}),this._personalizationToken},getCollectionsToken:function(){if(this._collectionsToken)return this._collectionsToken;if(!this.apiSecret)throw new p.SiteError("Missing secret, which is needed to perform signed requests, use var client = stream.connect(key, secret);");return this._collectionsToken=d.JWTScopeToken(this.apiSecret,"collections","*",{userId:"*",feedId:"*",expireTokens:this.expireTokens}),this._collectionsToken},getAnalyticsToken:function(){if(this.apiSecret)return d.JWTScopeToken(this.apiSecret,"analytics","*",{userId:"*",expireTokens:this.expireTokens});throw new p.SiteError("Missing secret, which is needed to perform signed requests, use var client = stream.connect(key, secret);")},getBaseUrl:function(t){t||(t="api");var e,n=this.baseUrl;("api"!=t&&(n="https://"+t+".stream-io-api.com/"+t+"/"),this.location)&&(n=(this.options.protocol||"https")+"://"+this.location+"-"+t+".stream-io-api.com/"+t+"/");return(void 0!==c&&c.env.LOCAL||this.options.local)&&(n="http://localhost:8000/"+t+"/"),e="api"==t?"STREAM_BASE_URL":"STREAM_"+t.toUpperCase()+"_URL",void 0!==c&&c.env[e]&&(n=c.env[e]),this.options.urlOverride&&this.options.urlOverride[t]?this.options.urlOverride[t]:n},on:function(t,e){this.handlers[t]=e},off:function(t){void 0===t?this.handlers={}:delete this.handlers[t]},send:function(){var t=Array.prototype.slice.call(arguments),e=t[0];t=t.slice(1),this.handlers[e]&&this.handlers[e].apply(this,t)},wrapPromiseTask:function(t,i,r){var s=this,o=this.wrapCallback(t);return function(t,e,n){t?r(new p.StreamApiError(t,n,e)):/^2/.test(""+e.statusCode)?i(n):r(new p.StreamApiError(JSON.stringify(n)+" with HTTP status code "+e.statusCode,n,e)),o.call(s,t,e,n)}},wrapCallback:function(n){var i=this;return function(){var t=Array.prototype.slice.call(arguments),e=["response"].concat(t);i.send.apply(i,e),void 0!==n&&n.apply(i,t)}},userAgent:function(){return"stream-javascript-client-"+(this.node?"node":"browser")+"-unknown"},getReadOnlyToken:function(t,e){return this.feed(t,e).getReadOnlyToken()},getReadWriteToken:function(t,e){return this.feed(t,e).getReadWriteToken()},feed:function(t,e,n,i,r){if(this.apiSecret&&!n){var s=""+t+e;n=(r=r||{}).readOnly?this.getReadOnlyToken(t,e):d.sign(this.apiSecret,s)}var o=new a(this,t,e,n,i);return o},enrichUrl:function(t,e){return e||(e="api"),this.getBaseUrl(e)+this.version+"/"+t},enrichKwargs:function(t){t.url=this.enrichUrl(t.url,t.serviceName),void 0===t.qs&&(t.qs={}),this.browser||(t.agent=this.requestAgent),t.qs.api_key=this.apiKey,t.qs.location=this.group,t.json=!0;var e=t.signature||this.signature;return t.headers={},d.isJWTSignature(e)?(t.headers["stream-auth-type"]="jwt",e=e.split(" ").reverse()[0]):t.headers["stream-auth-type"]="simple",t.timeout=1e4,t.headers.Authorization=e,t.headers["X-Stream-Client"]=this.userAgent(),t.withCredentials=!1,t},signActivity:function(t){return this.signActivities([t])[0]},signActivities:function(t){if(!this.apiSecret)return t;for(var e=[],n=0;n<t.length;n++){var i=l({},t[n]),r=i.to||[];if(0<r.length){for(var s=[],o=0;o<r.length;o++){var a=r[o],c=a.split(":")[0],u=a.split(":")[1],h=a+" "+this.feed(c,u).token;s.push(h)}i.to=s}e.push(i)}return e},getFayeAuthorization:function(){var i=this.apiKey,r=this;return{incoming:function(t,e){e(t)},outgoing:function(t,e){if(t.subscription&&r.subscriptions[t.subscription]){var n=r.subscriptions[t.subscription];t.ext={user_id:n.userId,api_key:i,signature:n.token}}e(t)}}},getFayeClient:function(){if(null===this.fayeClient){this.fayeClient=new n.Client(this.fayeUrl,{timeout:10});var t=this.getFayeAuthorization();this.fayeClient.addExtension(t)}return this.fayeClient},get:function(i,r){return new e(function(t,e){this.send("request","get",i,r),(i=this.enrichKwargs(i)).method="GET",i.gzip=!0;var n=this.wrapPromiseTask(r,t,e);this.request(i,n)}.bind(this))},post:function(i,r){return new e(function(t,e){this.send("request","post",i,r),(i=this.enrichKwargs(i)).method="POST",i.gzip=!0;var n=this.wrapPromiseTask(r,t,e);this.request(i,n)}.bind(this))},delete:function(i,r){return new e(function(t,e){this.send("request","delete",i,r),(i=this.enrichKwargs(i)).gzip=!0,i.method="DELETE";var n=this.wrapPromiseTask(r,t,e);this.request(i,n)}.bind(this))},put:function(i,r){return new e(function(t,e){this.send("request","put",i,r),(i=this.enrichKwargs(i)).method="PUT",i.gzip=!0;var n=this.wrapPromiseTask(r,t,e);this.request(i,n)}.bind(this))},createUserSession:function(t){return new(_(22).StreamCloudClient)(this.apiKey,null,this.appId,this.options).createUserSession(t)},createUserSessionToken:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return d.JWTUserSessionToken(this.apiSecret,t,e)},updateActivities:function(t,e){if(!(t instanceof Array))throw new TypeError("The activities argument should be an Array");var n=d.JWTScopeToken(this.apiSecret,"activities","*",{feedId:"*",expireTokens:this.expireTokens}),i={activities:t};return this.post({url:"activities/",body:i,signature:n},e)},updateActivity:function(t,e){return this.updateActivities([t],e)},getActivities:function(t,e){var n={};if(t.ids){var i=t.ids;if(!(i instanceof Array))throw new TypeError("The ids argument should be an Array");n.ids=i.join(",")}else{if(!t.foreignIDTimes)throw new TypeError("Missing ids or foreignIDTimes params");var r=t.foreignIDTimes;if(!(r instanceof Array))throw new TypeError("The foreignIDTimes argument should be an Array");var s=[],o=[];for(var a in r){if(!(r[a]instanceof Object))throw new TypeError("foreignIDTimes elements should be Objects");s.push(r[a].foreignID),o.push(r[a].time)}n.foreign_ids=s.join(","),n.timestamps=o.join(",")}var c=d.JWTScopeToken(this.apiSecret,"activities","*",{feedId:"*",expireTokens:this.expireTokens});return this.get({url:"activities/",qs:n,signature:c},e)},activityPartialUpdate:function(t,e){if(t.foreignID&&(t.foreign_id=t.foreignID,delete t.foreignID),void 0===t.id&&(void 0===t.foreign_id||void 0===t.time))throw new TypeError("Missing id or foreign ID and time");if(t.set&&!(t.set instanceof Object))throw new TypeError("set field should be an Object");if(t.unset&&!(t.unset instanceof Array))throw new TypeError("unset field should be an Array");var n=d.JWTScopeToken(this.apiSecret,"activities","*",{feedId:"*",expireTokens:this.expireTokens});return this.post({url:"activity/",body:t,signature:n},e)}},v&&(i.prototype.createRedirectUrl=function(t,e,n){var i=g.parse(t);if(!(i.host||i.hostname&&i.port||i.isUnix))throw new p.MissingSchemaError('Invalid URI: "'+g.format(i)+'"');var r=d.JWTScopeToken(this.apiSecret,"redirect_and_track","*",{userId:"*",expireTokens:this.expireTokens}),s=this.baseAnalyticsUrl+"redirect/",o={auth_type:"jwt",authorization:r,url:t,api_key:this.apiKey,events:JSON.stringify(n)};return s+"?"+y.rfc3986(v.stringify(o,null,null,{}))}),t)for(var r in t)t.hasOwnProperty(r)&&(i.prototype[r]=t[r]);s.exports=i}).call(this,_(19))},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e){t.exports=function(e,n){return function(t){return e(n(t))}}},function(t,e,n){var i=n(36)(Object.getPrototypeOf,Object);t.exports=i},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e,n){var i=n(20),r=Object.prototype,s=r.hasOwnProperty,o=r.toString,a=i?i.toStringTag:void 0;t.exports=function(t){var e=s.call(t,a),n=t[a];try{var i=!(t[a]=void 0)}catch(t){}var r=o.call(t);return i&&(e?t[a]=n:delete t[a]),r}},function(n,t,e){(function(t){var e="object"==typeof t&&t&&t.Object===Object&&t;n.exports=e}).call(this,e(2))},function(t,e,n){var i=n(40),r="object"==typeof self&&self&&self.Object===Object&&self,s=i||r||Function("return this")();t.exports=s},function(t,e,n){var i=n(20),r=n(39),s=n(38),o=i?i.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":o&&o in Object(t)?r(t):s(t)}},function(t,e,n){var i=n(42),r=n(37),s=n(35),o=Function.prototype,a=Object.prototype,c=o.toString,u=a.hasOwnProperty,h=c.call(Object);t.exports=function(t){if(!s(t)||"[object Object]"!=i(t))return!1;var e=r(t);if(null===e)return!0;var n=u.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&c.call(n)==h}},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e){var n=function(){this.initialize.apply(this,arguments)};n.prototype={initialize:function(t,e){this.client=t,this.token=e},buildURL:function(t){var e="permissions/";return void 0===t?e:e+t+"/"},get:function(t){return this.client.get({url:this.buildURL(),signature:this.token},t)},add:function(t,e){return this.client.post({url:this.buildURL(),body:t,signature:this.token},e)},delete:function(t,e){return this.client.delete({url:this.buildURL(t),signature:this.token},e)}},t.exports=n},function(t,e,n){var i=n(12),r=n(10),s=n(10).Headers,o=n(21),a=n(11),c=function(){this.initialize.apply(this,arguments)};c.prototype={initialize:function(t,e){this.client=t,this.token=e},upload:function(t,e){var n,i=new o;return n=a.isReadableStream(t)?t:{uri:t,type:"application/octet-stream",name:e||t.split("/").reverse()[0]},i.append("file",n),r("".concat(this.client.enrichUrl("images/"),"?api_key=").concat(this.client.apiKey),{method:"post",body:i,headers:new s({Authorization:this.token})}).then(function(t){return t.json()})},delete:function(t){return this.client.delete({url:"images/".concat(t),signature:this.token})},process:function(t,e){var n=i(e);return Array.isArray(n.crop)&&(n.crop=n.crop.join(",")),this.client.get({url:"images/".concat(t),qs:n,signature:this.token})},thumbmail:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{crop:"center",resize:"clip"},r=i.crop,s=i.resize;return this.process(t,{w:e,h:n,crop:r,resize:s})}},t.exports=c},function(t,e,n){var r=n(10),s=n(10).Headers,o=n(11),a=n(21),i=function(){this.initialize.apply(this,arguments)};i.prototype={initialize:function(t,e){this.client=t,this.token=e},upload:function(t,e){var n,i=new a;return n=o.isReadableStream(t)?t:{uri:t,type:"application/octet-stream",name:e||t.split("/").reverse()[0]},i.append("file",n),r("".concat(this.client.enrichUrl("files/"),"?api_key=").concat(this.client.apiKey),{method:"post",body:i,headers:new s({Authorization:this.token})}).then(function(t){return t.json()})},delete:function(t){return this.client.delete({url:"files/".concat(t),signature:this.token})}},t.exports=i},function(t,e,n){var o=n(9),i=function(){this.initialize.apply(this,arguments)};i.prototype={initialize:function(t,e){this.client=t,this.token=e,this.signature=e},buildURL:function(){for(var t="reaction/",e=0;e<arguments.length;e++)t+=arguments[e]+"/";return t},all:function(t,e){return this.client.get({url:this.buildURL(),signature:this.signature},e)},_convertTargetFeeds:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).map(function(t){return"string"==typeof t?t:t.id})},add:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=n.id,r=n.data,s=n.targetFeeds,o=3<arguments.length?arguments[3]:void 0;e instanceof Object&&(e=e.id);var a={activity_id:e,kind:t,id:i,data:r,target_feeds:s=this._convertTargetFeeds(s)};return this.client.post({url:this.buildURL(),body:a,signature:this.signature},o)},get:function(t,e){return this.client.get({url:this.buildURL(t),signature:this.signature},e)},filter:function(t,e){var n={limit:t.limit?t.limit:20};if(t.id_lt&&(n.id_lt=t.id_lt),t.id_lte&&(n.id_lte=t.id_lte),t.id_gt&&(n.id_gt=t.id_gt),t.id_gte&&(n.id_gte=t.id_gte),t.user_id&&t.activity_id)throw new o.SiteError("Cannot use both activity_id and user_id params");if(!t.user_id&&!t.activity_id)throw new o.SiteError("Must use either activity_id or user_id param");var i=t.user_id?"user_id":"activity_id",r=t.user_id?t.user_id:t.activity_id,s=this.buildURL(i,r);return t.kind&&(s=this.buildURL(i,r,t.kind)),this.client.get({url:s,qs:n,signature:this.signature},e)},update:function(t,e,n){var i=e.data,r=e.targetFeeds,s={data:i,target_feeds:r=this._convertTargetFeeds(r)};return this.client.put({url:this.buildURL(t),body:s,signature:this.signature},n)},delete:function(t,e){return this.client.delete({url:this.buildURL(t),signature:this.signature},e)}},t.exports=i},function(t,e){function a(t){this.message=t}(a.prototype=new Error).name="InvalidCharacterError",t.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,i,r=0,s=0,o="";i=e.charAt(s++);~i&&(n=r%4?64*n+i:i,r++%4)?o+=String.fromCharCode(255&n>>(-2*r&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return o}},function(t,e,n){var i=n(49);t.exports=function(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return decodeURIComponent(i(e).replace(/(.)/g,function(t,e){var n=e.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}catch(t){return i(e)}}},function(t,e,n){"use strict";var i=n(50);function r(t){this.message=t}(r.prototype=new Error).name="InvalidTokenError",t.exports=function(t,e){if("string"!=typeof t)throw new r("Invalid token specified");var n=!0===(e=e||{}).header?0:1;try{return JSON.parse(i(t.split(".")[n]))}catch(t){throw new r("Invalid token specified: "+t.message)}},t.exports.InvalidTokenError=r},function(t,e){var n=function(){this.initialize.apply(this,arguments)};n.prototype={initialize:function(t,e,n){this.client=t,this.id=e,this.data=void 0,this.full=void 0,this.token=n,this.url="user/"+this.id+"/"},_streamRef:function(){return"SU:".concat(this.id)},get:function(t,e){var n=this;return this.client.get({url:this.url,signature:this.token,qs:t}).then(function(t){return n.full=t,n.data=t.data,e&&e(t),t})},_chooseData:function(t){return void 0!==t?t:void 0!==this.data?this.data:{}},create:function(t,e,n){var i=this;return this.client.post({url:"user/",body:{id:this.id,data:this._chooseData(t)},qs:e,signature:this.token}).then(function(t){return i.full=t,i.data=t.data,n&&n(t),t})},update:function(t,e){var n=this;return this.client.put({url:this.url,body:{data:this._chooseData(t)},signature:this.token}).then(function(t){return n.full=t,n.data=t.data,e&&e(t),t})},getOrCreate:function(t,e){return this.create(t,{get_or_create:!0},e)},profile:function(t){return this.get({with_follow_counts:!0},t)}},t.exports=n},function(t,e,n){var i=n(52),r=n(51),s=function(){this.initialize.apply(this,arguments)};s.prototype={initialize:function(t,e){var n=r(e);if(!n.user_id)throw new TypeError("user_id is missing in jwt token");this.client=t,this.userId=n.user_id,this.token=e,this.user=new i(t,this.userId,e),this.reactions=t.reactions(e),this.images=this.client.images(this.token),this.files=this.client.files(this.token),this.permissions=this.client.permissions(this.token)},feed:function(t,e){return void 0===e?e=this.userId:e instanceof i&&(e=e.id),this.client.feed(t,e,this.token)},personalizedFeed:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length?arguments[1]:void 0;return this.client.get({url:"enrich/personalization/feed/",qs:t,signature:this.token},e)},followUser:function(t){return t instanceof i&&(t=t.id),this.feed("timeline").follow("user",t)},getUser:function(t){return new i(this.client,t,this.token)},storage:function(t){return this.client.storage(t,this.token)},collection:function(t){return this.client.collection(t,this.token)},react:function(t,e,n){return this.reactions.add(t,e,n)},objectFromResponse:function(t){var e=this.collection(t.collection).object(t.id,t.data);return e.full=t,e},collectionEntryFromResponse:function(t){var e=this.collection(t.collection).entry(t.id,t.data);return e.full=t,e},og:function(t){return this.client.get({url:"og/",qs:{url:t},signature:this.token})}},t.exports=s},function(t,e){var n=function(){this.initialize.apply(this,arguments)};n.prototype={initialize:function(t,e,n){this.client=t,this.collection=e,this.token=n,this.signature=this.collection+" "+this.token},buildURL:function(t){var e="object_store/"+this.collection+"/";return void 0===t?e:e+t+"/"},entry:function(t,e){return new i(this,t,e)},object:function(t,e){return new i(this,t,e)},items:function(t,e){return this.client.get({url:this.buildURL(),signature:this.signature},e)},get:function(t,e){return this.client.get({url:this.buildURL(t),signature:this.signature},e)},add:function(t,e,n){null===t&&(t=void 0);var i={id:t,data:e};return this.client.post({url:this.buildURL(),body:i,signature:this.signature},n)},update:function(t,e,n){var i={data:e};return this.client.put({url:this.buildURL(t),body:i,signature:this.signature},n)},delete:function(t,e){return this.client.delete({url:this.buildURL(t),signature:this.signature},e)}};var i=function(){this.initialize.apply(this,arguments)};i.prototype={initialize:function(t,e,n){this.collection=t.collection,this.store=t,this.id=e,this.data=n},_streamRef:function(){return"SO:".concat(this.collection,":").concat(this.id)},get:function(e){var n=this;return this.store.get(this.id).then(function(t){return n.data=t.data,n.full=t,e&&e(t),t})},add:function(e){var n=this;return this.store.add(this.id,this.data).then(function(t){return n.data=t.data,n.full=t,e&&e(t),t})},update:function(e){var n=this;return this.store.update(this.id,this.data).then(function(t){return n.data=t.data,n.full=t,e&&e(t),t})},delete:function(e){var n=this;return this.store.delete(this.id).then(function(t){return n.data=null,n.full=null,e&&e(t),t})}},t.exports=n},function(t,e){},function(t,e){},function(t,e,n){"use strict";var i=n(1),r=n(0),s=n(5),o=i({initialize:function(t,e,n,i){this._client=t,this._channels=e,this._callback=n,this._context=i,this._cancelled=!1},withChannel:function(t,e){return this._withChannel=[t,e],this},apply:function(t,e){var n=e[0];this._callback&&this._callback.call(this._context,n.data),this._withChannel&&this._withChannel[0].call(this._withChannel[1],n.channel,n.data)},cancel:function(){this._cancelled||(this._client.unsubscribe(this._channels,this),this._cancelled=!0)},unsubscribe:function(){this.cancel()}});r(o.prototype,s),t.exports=o},function(t,e,n){"use strict";var i=n(1),r=n(5);t.exports=i(r)},function(t,e,n){"use strict";var i={addExtension:function(t){this._extensions=this._extensions||[],this._extensions.push(t),t.added&&t.added(this)},removeExtension:function(t){if(this._extensions)for(var e=this._extensions.length;e--;)this._extensions[e]===t&&(this._extensions.splice(e,1),t.removed&&t.removed(this))},pipeThroughExtensions:function(i,t,r,s,o){if(this.debug("Passing through ? extensions: ?",i,t),!this._extensions)return s.call(o,t);var a=this._extensions.slice(),c=function(t){if(!t)return s.call(o,t);var e=a.shift();if(!e)return s.call(o,t);var n=e[i];if(!n)return c(t);3<=n.length?e[i](t,r,c):e[i](t,c)};c(t)}};n(0)(i,n(7)),t.exports=i},function(t,e,n){"use strict";var i=n(1),r=n(27),s=i({initialize:function(t,e,n){this.code=t,this.params=Array.prototype.slice.call(e),this.message=n},toString:function(){return this.code+":"+this.params.join(",")+":"+this.message}});s.parse=function(t){if(t=t||"",!r.ERROR.test(t))return new s(null,[],t);var e=t.split(":"),n=parseInt(e[0]),i=e[1].split(",");t=e[2];return new s(n,i,t)};var o={versionMismatch:[300,"Version mismatch"],conntypeMismatch:[301,"Connection types not supported"],extMismatch:[302,"Extension mismatch"],badRequest:[400,"Bad request"],clientUnknown:[401,"Unknown client"],parameterMissing:[402,"Missing required parameter"],channelForbidden:[403,"Forbidden channel"],channelUnknown:[404,"Unknown channel"],channelInvalid:[405,"Invalid channel"],extUnknown:[406,"Unknown extension"],publishFailed:[407,"Failed to publish"],serverError:[500,"Internal server error"]};for(var a in o)!function(t){s[t]=function(){return new s(o[t][0],arguments,o[t][1]).toString()}}(a);t.exports=s},function(n,t,i){"use strict";(function(a){var t=i(1),c=i(3),u=i(13),e=i(0),h=i(6),l=e(t(i(4),{encode:function(t){var e=u(this.endpoint);return e.query.message=h(t),e.query.jsonp="__jsonp"+l._cbCount+"__",c.stringify(e)},request:function(t){var e=document.getElementsByTagName("head")[0],n=document.createElement("script"),i=l.getCallbackName(),r=u(this.endpoint),s=this;r.query.message=h(t),r.query.jsonp=i;var o=function(){if(!a[i])return!1;a[i]=void 0;try{delete a[i]}catch(t){}n.parentNode.removeChild(n)};return a[i]=function(t){o(),s._receive(t)},n.type="text/javascript",n.src=c.stringify(r),e.appendChild(n),n.onerror=function(){o(),s._handleError(t)},{abort:o}}}),{_cbCount:0,getCallbackName:function(){return this._cbCount+=1,"__jsonp"+this._cbCount+"__"},isUsable:function(t,e,n,i){n.call(i,!0)}});n.exports=l}).call(this,i(2))},function(r,t,s){"use strict";(function(c){var t=s(1),e=s(25),u=s(3),n=s(0),i=s(6),h=n(t(s(4),{encode:function(t){return"message="+encodeURIComponent(i(t))},request:function(e){var t,n=c.XDomainRequest?XDomainRequest:XMLHttpRequest,i=new n,r=++h._id,s=this._dispatcher.headers,o=this;if(i.open("POST",u.stringify(this.endpoint),!0),i.setRequestHeader)for(t in i.setRequestHeader("Pragma","no-cache"),s)s.hasOwnProperty(t)&&i.setRequestHeader(t,s[t]);var a=function(){if(!i)return!1;h._pending.remove(r),i.onload=i.onerror=i.ontimeout=i.onprogress=null,i=null};return i.onload=function(){var t;try{t=JSON.parse(i.responseText)}catch(t){}a(),t?o._receive(t):o._handleError(e)},i.onerror=i.ontimeout=function(){a(),o._handleError(e)},i.onprogress=function(){},n===c.XDomainRequest&&h._pending.add({id:r,xhr:i}),i.send(this.encode(e)),i}}),{_id:0,_pending:new e,isUsable:function(t,e,n,i){if(u.isSameOrigin(e))return n.call(i,!1);if(c.XDomainRequest)return n.call(i,e.protocol===location.protocol);if(c.XMLHttpRequest){var r=new XMLHttpRequest;return n.call(i,void 0!==r.withCredentials)}return n.call(i,!1)}});r.exports=h}).call(this,s(2))},function(u,t,h){"use strict";(function(r){var t=h(1),s=h(3),o=h(13),e=h(0),n=h(5),a=h(4),c=h(24),i=e(t(a,{initialize:function(t,e){if(a.prototype.initialize.call(this,t,e),!r.EventSource)return this.setDeferredStatus("failed");this._xhr=new c(t,e),(e=o(e)).pathname+="/"+t.clientId;var n=new r.EventSource(s.stringify(e)),i=this;n.onopen=function(){i._everConnected=!0,i.setDeferredStatus("succeeded")},n.onerror=function(){i._everConnected?i._handleError([]):(i.setDeferredStatus("failed"),n.close())},n.onmessage=function(t){var e;try{e=JSON.parse(t.data)}catch(t){}e?i._receive(e):i._handleError([])},this._socket=n},close:function(){this._socket&&(this._socket.onopen=this._socket.onerror=this._socket.onmessage=null,this._socket.close(),delete this._socket)},isUsable:function(t,e){this.callback(function(){t.call(e,!0)}),this.errback(function(){t.call(e,!1)})},encode:function(t){return this._xhr.encode(t)},request:function(t){return this._xhr.request(t)}}),{isUsable:function(e,n,i,r){if(!e.clientId)return i.call(r,!1);c.isUsable(e,n,function(t){if(!t)return i.call(r,!1);this.create(e,n).isUsable(i,r)},this)},create:function(t,e){var n=t.transports.eventsource=t.transports.eventsource||{},i=t.clientId,r=o(e);return r.pathname+="/"+(i||""),n[r=s.stringify(r)]=n[r]||new this(t,e),n[r]}});e(i.prototype,n),u.exports=i}).call(this,h(2))},function(e,t,n){"use strict";(function(t){var i=t.MozWebSocket||t.WebSocket;e.exports={create:function(t,e,n){return"function"!=typeof i?null:new i(t)}}}).call(this,n(2))},function(f,t,d){"use strict";(function(t){var e=d(1),s=d(8),o=d(25),n=d(3),i=d(15),r=d(13),a=d(0),c=d(6),u=d(64),h=d(5),l=a(e(d(4),{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(t,e){this.callback(function(){t.call(e,!0)}),this.errback(function(){t.call(e,!1)}),this.connect()},request:function(n){this._pending=this._pending||new o;for(var t=0,e=n.length;t<e;t++)this._pending.add(n[t]);var i=this,r=new s(function(e,t){i.callback(function(t){t&&1===t.readyState&&(t.send(c(n)),e(t))}),i.connect()});return{abort:function(){r.then(function(t){t.close()})}}},connect:function(){if(!l._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var n=this._createSocket();if(!n)return this.setDeferredStatus("failed");var r=this,i=!(n.onopen=function(){n.headers&&r._storeCookies(n.headers["set-cookie"]),r._socket=n,r._state=r.CONNECTED,r._everConnected=!0,r._ping(),r.setDeferredStatus("succeeded",n)});n.onclose=n.onerror=function(){if(!i){i=!0;var t=r._state===r.CONNECTED;n.onopen=n.onclose=n.onerror=n.onmessage=null,delete r._socket,r._state=r.UNCONNECTED,r.removeTimeout("ping");var e=r._pending?r._pending.toArray():[];delete r._pending,t||r._everConnected?(r.setDeferredStatus("unknown"),r._handleError(e,t)):r.setDeferredStatus("failed")}},n.onmessage=function(t){var e;try{e=JSON.parse(t.data)}catch(t){}if(e){for(var n=0,i=(e=[].concat(e)).length;n<i;n++)void 0!==e[n].successful&&r._pending.remove(e[n]);r._receive(e)}}}},close:function(){this._socket&&this._socket.close()},_createSocket:function(){var t=l.getSocketUrl(this.endpoint),e=this._dispatcher.headers,n=this._dispatcher.wsExtensions,i=this._getCookies(),r=this._dispatcher.tls,s={extensions:n,headers:e,proxy:this._proxy,tls:r};return""!==i&&(s.headers.Cookie=i),u.create(t,[],s)},_ping:function(){this._socket&&1===this._socket.readyState&&(this._socket.send("[]"),this.addTimeout("ping",this._dispatcher.timeout/2,this._ping,this))}}),{PROTOCOLS:{"http:":"ws:","https:":"wss:"},create:function(t,e){var n=t.transports.websocket=t.transports.websocket||{};return n[e.href]=n[e.href]||new this(t,e),n[e.href]},getSocketUrl:function(t){return(t=r(t)).protocol=this.PROTOCOLS[t.protocol],n.stringify(t)},isUsable:function(t,e,n,i){this.create(t,e).isUsable(n,i)}});a(l.prototype,h),i.Event&&void 0!==t.onbeforeunload&&i.Event.on(t,"beforeunload",function(){l._unloaded=!0}),f.exports=l}).call(this,d(2))},function(t,e,n){"use strict";(function(s){t.exports={addTimeout:function(t,e,n,i){if(this._timeouts=this._timeouts||{},!this._timeouts.hasOwnProperty(t)){var r=this;this._timeouts[t]=s.setTimeout(function(){delete r._timeouts[t],n.call(i)},1e3*e)}},removeTimeout:function(t){this._timeouts=this._timeouts||{};var e=this._timeouts[t];e&&(s.clearTimeout(e),delete this._timeouts[t])},removeAllTimeouts:function(){for(var t in this._timeouts=this._timeouts||{},this._timeouts)this.removeTimeout(t)}}}).call(this,n(2))},function(t,e,n){"use strict";var i=n(4);i.register("websocket",n(65)),i.register("eventsource",n(63)),i.register("long-polling",n(24)),i.register("cross-origin-long-polling",n(62)),i.register("callback-polling",n(61)),t.exports=i},function(h,t,l){"use strict";(function(o){var t=l(1),a=l(3),c=l(26),e=l(0),n=l(7),i=l(14),r=l(67),u=l(23),s=t({className:"Dispatcher",MAX_REQUEST_SIZE:2048,DEFAULT_RETRY:5,UP:1,DOWN:2,initialize:function(t,e,n){this._client=t,this.endpoint=a.parse(e),this._alternates=n.endpoints||{},this.cookies=c.CookieJar&&new c.CookieJar,this._disabled=[],this._envelopes={},this.headers={},this.retry=n.retry||this.DEFAULT_RETRY,this._scheduler=n.scheduler||u,this._state=0,this.transports={},this.wsExtensions=[],this.proxy=n.proxy||{},"string"==typeof this._proxy&&(this._proxy={origin:this._proxy});var i=n.websocketExtensions;if(i)for(var r=0,s=(i=[].concat(i)).length;r<s;r++)this.addWebsocketExtension(i[r]);for(var o in this.tls=n.tls||{},this.tls.ca=this.tls.ca||n.ca,this._alternates)this._alternates[o]=a.parse(this._alternates[o]);this.maxRequestSize=this.MAX_REQUEST_SIZE},endpointFor:function(t){return this._alternates[t]||this.endpoint},addWebsocketExtension:function(t){this.wsExtensions.push(t)},disable:function(t){this._disabled.push(t)},setHeader:function(t,e){this.headers[t]=e},close:function(){var t=this._transport;delete this._transport,t&&t.close()},getConnectionTypes:function(){return r.getConnectionTypes()},selectTransport:function(t){r.get(this,t,this._disabled,function(t){this.debug("Selected ? transport for ?",t.connectionType,a.stringify(t.endpoint)),t!==this._transport&&(this._transport&&this._transport.close(),this._transport=t,this.connectionType=t.connectionType)},this)},sendMessage:function(t,e,n){n=n||{};var i,r=t.id,s=n.attempts,o=n.deadline&&(new Date).getTime()+1e3*n.deadline,a=this._envelopes[r];a||(i=new this._scheduler(t,{timeout:e,interval:this.retry,attempts:s,deadline:o}),a=this._envelopes[r]={message:t,scheduler:i}),this._sendEnvelope(a)},_sendEnvelope:function(t){if(this._transport&&!t.request&&!t.timer){var e=t.message,n=t.scheduler,i=this;if(!n.isDeliverable())return n.abort(),void delete this._envelopes[e.id];t.timer=o.setTimeout(function(){i.handleError(e)},1e3*n.getTimeout()),n.send(),t.request=this._transport.sendMessage(e)}},handleResponse:function(t){var e=this._envelopes[t.id];void 0!==t.successful&&e&&(e.scheduler.succeed(),delete this._envelopes[t.id],o.clearTimeout(e.timer)),this.trigger("message",t),this._state!==this.UP&&(this._state=this.UP,this._client.trigger("transport:up"))},handleError:function(t,e){var n=this._envelopes[t.id],i=n&&n.request,r=this;if(i){i.then(function(t){t&&t.abort&&t.abort()});var s=n.scheduler;s.fail(),o.clearTimeout(n.timer),n.request=n.timer=null,e?this._sendEnvelope(n):n.timer=o.setTimeout(function(){n.timer=null,r._sendEnvelope(n)},1e3*s.getInterval()),this._state!==this.DOWN&&(this._state=this.DOWN,this._client.trigger("transport:down"))}}});s.create=function(t,e,n){return new s(t,e,n)},e(s.prototype,i),e(s.prototype,n),h.exports=s}).call(this,l(2))},function(t,e){var o="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};function n(){}(t.exports=n).prototype.emit=function(t){if("error"===t&&(!this._events||!this._events.error||o(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"==typeof e){switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:var n=Array.prototype.slice.call(arguments,1);e.apply(this,n)}return!0}if(o(e)){n=Array.prototype.slice.call(arguments,1);for(var i=e.slice(),r=0,s=i.length;r<s;r++)i[r].apply(this,n);return!0}return!1},n.prototype.on=n.prototype.addListener=function(t,e){if("function"!=typeof e)throw new Error("addListener only takes instances of Function");return this._events||(this._events={}),this.emit("newListener",t,e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,this},n.prototype.once=function(e,n){var i=this;return i.on(e,function t(){i.removeListener(e,t),n.apply(this,arguments)}),this},n.prototype.removeListener=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var n=this._events[t];if(o(n)){var i=function(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0;n<t.length;n++)if(e===t[n])return n;return-1}(n,e);if(i<0)return this;n.splice(i,1),0==n.length&&delete this._events[t]}else this._events[t]===e&&delete this._events[t];return this},n.prototype.removeAllListeners=function(t){return 0===arguments.length?this._events={}:t&&this._events&&this._events[t]&&(this._events[t]=null),this},n.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),o(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}},function(t,e,n){"use strict";var i=n(16);t.exports=function(t,e){for(var n in t)if(i.indexOf(e,n)<0)throw new Error("Unrecognized option: "+n)}},function(m,t,b){"use strict";(function(r){var s=b(30),t=b(1),o=(b(8),b(3)),a=b(16),n=b(15),c=b(29),e=b(0),u=b(70),i=b(5),h=b(7),l=b(14),f=b(28),d=b(68),p=b(60),y=b(59),v=b(58),g=b(57),_=t({className:"Client",UNCONNECTED:1,CONNECTING:2,CONNECTED:3,DISCONNECTED:4,HANDSHAKE:"handshake",RETRY:"retry",NONE:"none",CONNECTION_TIMEOUT:60,DEFAULT_ENDPOINT:"/bayeux",INTERVAL:0,initialize:function(t,e){this.info("New client created for ?",t),u(e=e||{},["interval","timeout","endpoints","proxy","retry","scheduler","websocketExtensions","tls","ca"]),this._channels=new f.Set,this._dispatcher=d.create(this,t||this.DEFAULT_ENDPOINT,e),this._messageId=0,this._state=this.UNCONNECTED,this._responseCallbacks={},this._advice={reconnect:this.RETRY,interval:1e3*(e.interval||this.INTERVAL),timeout:1e3*(e.timeout||this.CONNECTION_TIMEOUT)},this._dispatcher.timeout=this._advice.timeout/1e3,this._dispatcher.bind("message",this._receiveMessage,this),n.Event&&void 0!==r.onbeforeunload&&n.Event.on(r,"beforeunload",function(){a.indexOf(this._dispatcher._disabled,"autodisconnect")<0&&this.disconnect()},this)},addWebsocketExtension:function(t){return this._dispatcher.addWebsocketExtension(t)},disable:function(t){return this._dispatcher.disable(t)},setHeader:function(t,e){return this._dispatcher.setHeader(t,e)},handshake:function(e,n){if(this._advice.reconnect!==this.NONE&&this._state===this.UNCONNECTED){this._state=this.CONNECTING;var i=this;this.info("Initiating handshake with ?",o.stringify(this._dispatcher.endpoint)),this._dispatcher.selectTransport(c.MANDATORY_CONNECTION_TYPES),this._sendMessage({channel:f.HANDSHAKE,version:c.BAYEUX_VERSION,supportedConnectionTypes:this._dispatcher.getConnectionTypes()},{},function(t){t.successful?(this._state=this.CONNECTED,this._dispatcher.clientId=t.clientId,this._dispatcher.selectTransport(t.supportedConnectionTypes),this.info("Handshake successful: ?",this._dispatcher.clientId),this.subscribe(this._channels.getKeys(),!0),e&&s(function(){e.call(n)})):(this.info("Handshake unsuccessful"),r.setTimeout(function(){i.handshake(e,n)},1e3*this._dispatcher.retry),this._state=this.UNCONNECTED)},this)}},connect:function(t,e){if(this._advice.reconnect!==this.NONE&&this._state!==this.DISCONNECTED){if(this._state===this.UNCONNECTED)return this.handshake(function(){this.connect(t,e)},this);this.callback(t,e),this._state===this.CONNECTED&&(this.info("Calling deferred actions for ?",this._dispatcher.clientId),this.setDeferredStatus("succeeded"),this.setDeferredStatus("unknown"),this._connectRequest||(this._connectRequest=!0,this.info("Initiating connection for ?",this._dispatcher.clientId),this._sendMessage({channel:f.CONNECT,clientId:this._dispatcher.clientId,connectionType:this._dispatcher.connectionType},{},this._cycleConnection,this)))}},disconnect:function(){if(this._state===this.CONNECTED){this._state=this.DISCONNECTED,this.info("Disconnecting ?",this._dispatcher.clientId);var e=new v;return this._sendMessage({channel:f.DISCONNECT,clientId:this._dispatcher.clientId},{},function(t){t.successful?(this._dispatcher.close(),e.setDeferredStatus("succeeded")):e.setDeferredStatus("failed",p.parse(t.error))},this),this.info("Clearing channel listeners for ?",this._dispatcher.clientId),this._channels=new f.Set,e}},subscribe:function(n,e,i){if(n instanceof Array)return a.map(n,function(t){return this.subscribe(t,e,i)},this);var r=new g(this,n,e,i),t=!0===e;return this._channels.hasSubscription(n)&&!t?(this._channels.subscribe([n],r),r.setDeferredStatus("succeeded")):this.connect(function(){this.info("Client ? attempting to subscribe to ?",this._dispatcher.clientId,n),t||this._channels.subscribe([n],r),this._sendMessage({channel:f.SUBSCRIBE,clientId:this._dispatcher.clientId,subscription:n},{},function(t){if(!t.successful)return r.setDeferredStatus("failed",p.parse(t.error)),this._channels.unsubscribe(n,r);var e=[].concat(t.subscription);this.info("Subscription acknowledged for ? to ?",this._dispatcher.clientId,e),r.setDeferredStatus("succeeded")},this)},this),r},unsubscribe:function(t,e){if(t instanceof Array)return a.map(t,function(t){return this.unsubscribe(t,e)},this);this._channels.unsubscribe(t,e)&&this.connect(function(){this.info("Client ? attempting to unsubscribe from ?",this._dispatcher.clientId,t),this._sendMessage({channel:f.UNSUBSCRIBE,clientId:this._dispatcher.clientId,subscription:t},{},function(t){if(t.successful){var e=[].concat(t.subscription);this.info("Unsubscription acknowledged for ? from ?",this._dispatcher.clientId,e)}},this)},this)},publish:function(t,e,n){u(n||{},["attempts","deadline"]);var i=new v;return this.connect(function(){this.info("Client ? queueing published message to ?: ?",this._dispatcher.clientId,t,e),this._sendMessage({channel:t,data:e,clientId:this._dispatcher.clientId},n,function(t){t.successful?i.setDeferredStatus("succeeded"):i.setDeferredStatus("failed",p.parse(t.error))},this)},this),i},_sendMessage:function(t,e,n,i){t.id=this._generateMessageId();var r=this._advice.timeout?1.2*this._advice.timeout/1e3:1.2*this._dispatcher.retry;this.pipeThroughExtensions("outgoing",t,null,function(t){t&&(n&&(this._responseCallbacks[t.id]=[n,i]),this._dispatcher.sendMessage(t,r,e||{}))},this)},_generateMessageId:function(){return this._messageId+=1,this._messageId>=Math.pow(2,32)&&(this._messageId=0),this._messageId.toString(36)},_receiveMessage:function(t){var e,n=t.id;void 0!==t.successful&&(e=this._responseCallbacks[n],delete this._responseCallbacks[n]),this.pipeThroughExtensions("incoming",t,null,function(t){t&&(t.advice&&this._handleAdvice(t.advice),this._deliverMessage(t),e&&e[0].call(e[1],t))},this)},_handleAdvice:function(t){e(this._advice,t),this._dispatcher.timeout=this._advice.timeout/1e3,this._advice.reconnect===this.HANDSHAKE&&this._state!==this.DISCONNECTED&&(this._state=this.UNCONNECTED,this._dispatcher.clientId=null,this._cycleConnection())},_deliverMessage:function(t){t.channel&&void 0!==t.data&&(this.info("Client ? calling listeners for ? with ?",this._dispatcher.clientId,t.channel,t.data),this._channels.distributeMessage(t))},_cycleConnection:function(){this._connectRequest&&(this._connectRequest=null,this.info("Closed connection for ?",this._dispatcher.clientId));var t=this;r.setTimeout(function(){t.connect()},this._advice.interval)}});e(_.prototype,i),e(_.prototype,l),e(_.prototype,h),e(_.prototype,y),m.exports=_}).call(this,b(2))},function(t,e,n){"use strict";var i=n(29),r=n(7),s={VERSION:i.VERSION,Client:n(71),Scheduler:n(23)};r.wrapper=s,t.exports=s},function(t,e){},function(t,e){},function(f,t,e){"use strict";(function(t){function e(t){i.length||(n(),!0),i[i.length]=t}f.exports=e;var n,i=[],r=0;function s(){for(;r<i.length;){var t=r;if(r+=1,i[t].call(),1024<r){for(var e=0,n=i.length-r;e<n;e++)i[e]=i[e+r];i.length-=r,r=0}}i.length=0,r=0,!1}var o,a,c,u=void 0!==t?t:self,h=u.MutationObserver||u.WebKitMutationObserver;function l(i){return function(){var t=setTimeout(n,0),e=setInterval(n,50);function n(){clearTimeout(t),clearInterval(e),i()}}}n="function"==typeof h?(o=1,a=new h(s),c=document.createTextNode(""),a.observe(c,{characterData:!0}),function(){o=-o,c.data=o}):l(s),e.requestFlush=n,e.makeRequestCallFromTimer=l}).call(this,e(2))},function(t,e,n){var i=n(8);t.exports=i},function(t,e){},function(t,e,n){!function(){var t=e,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function c(t){this.message=t}(c.prototype=new Error).name="InvalidCharacterError",t.btoa||(t.btoa=function(t){for(var e,n,i=String(t),r=0,s=a,o="";i.charAt(0|r)||(s="=",r%1);o+=s.charAt(63&e>>8-r%1*8)){if(255<(n=i.charCodeAt(r+=.75)))throw new c("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");e=e<<8|n}return o}),t.atob||(t.atob=function(t){var e=String(t).replace(/[=]+$/,"");if(e.length%4==1)throw new c("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,i,r=0,s=0,o="";i=e.charAt(s++);~i&&(n=r%4?64*n+i:i,r++%4)?o+=String.fromCharCode(255&n>>(-2*r&6)):0)i=a.indexOf(i);return o})}()},function(t,e){},function(t,e){},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e){var n=function(){this.initialize.apply(this,arguments)};n.prototype={initialize:function(t){this.client=t},get:function(t,e,n){var i=arguments[arguments.length-1];return n=i.call?i:void 0,e&&!e.call||(e={}),this.client.get({url:t+"/",serviceName:"personalization",qs:e,signature:this.client.getPersonalizationToken()},n)},post:function(t,e,n,i){var r=arguments[arguments.length-1];return i=r.call?r:void 0,e&&!e.call||(e={}),n&&!n.call||(n={}),this.client.post({url:t+"/",serviceName:"personalization",qs:e,body:n,signature:this.client.getPersonalizationToken()},i)},delete:function(t,e,n){var i=arguments[arguments.length-1];return n=i.call?i:void 0,e&&!e.call||(e={}),this.client.delete({url:t+"/",serviceName:"personalization",qs:e,signature:this.client.getPersonalizationToken()},n)}},t.exports=n},function(t,e){var n=function(){this.initialize.apply(this,arguments)};n.prototype={initialize:function(t){this.client=t},createReference:function(t,e){return"SO:"+t+":"+e},createUserReference:function(t){return this.createReference("user",t)},upsert:function(t,e,n){var i=arguments[arguments.length-1];n=i.call?i:void 0,Array.isArray(e)||(e=[e]);var r={data:{}};return r.data[t]=e,this.client.post({url:"meta/",serviceName:"api",body:r,signature:this.client.getCollectionsToken()},n)},select:function(e,t,n){var i=arguments[arguments.length-1];n=i.call?i:void 0,Array.isArray(t)||(t=[t]);var r={foreign_ids:t.map(function(t){return e+":"+t}).join(",")};return this.client.get({url:"meta/",serviceName:"api",qs:r,signature:this.client.getCollectionsToken()},n)},delete:function(t,e,n){var i=arguments[arguments.length-1];n=i.call?i:void 0,Array.isArray(e)||(e=[e]);var r={collection_name:t,ids:e=e.map(function(t){return t.toString()}).join(",")};return this.client.delete({url:"meta/",serviceName:"api",qs:r,signature:this.client.getCollectionsToken()},n)}},t.exports=n},function(r,t,s){(function(o){var a=s(34),t=s(9),e=s(17),n=s(33),i=s(22);r.exports.connect=function(t,e,n,i){if(void 0!==o&&o.env.STREAM_URL&&!t){var r=/https:\/\/(\w+):(\w+)@([\w-]*).*\?app_id=(\d+)/.exec(o.env.STREAM_URL);t=r[1],e=r[2];var s=r[3];n=r[4],void 0===i&&(i={}),"getstream"!==s&&"stream-io-api"!==s&&(i.location=s)}return new a(t,e,n,i)},r.exports.connectCloud=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return new i.StreamCloudClient(t,null,e,n)},r.exports.errors=t,r.exports.request=n,r.exports.signing=e,r.exports.Client=a}).call(this,s(19))},function(t,e){!function(t){"use strict";if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,o="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in t,r="ArrayBuffer"in t;if(r)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=function(t){return t&&DataView.prototype.isPrototypeOf(t)},c=ArrayBuffer.isView||function(t){return t&&-1<s.indexOf(Object.prototype.toString.call(t))};p.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},p.prototype.delete=function(t){delete this.map[l(t)]},p.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},p.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},p.prototype.set=function(t,e){this.map[l(t)]=f(e)},p.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},p.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),d(n)},p.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),d(e)},p.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),d(n)},n&&(p.prototype[Symbol.iterator]=p.prototype.entries);var u=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},m.call(b.prototype),m.call(T.prototype),T.prototype.clone=function(){return new T(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},T.error=function(){var t=new T(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];T.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new T(null,{status:e,headers:{location:t}})},t.Headers=p,t.Request=b,t.Response=T,t.fetch=function(n,r){return new Promise(function(i,t){var e=new b(n,r),s=new XMLHttpRequest;s.onload=function(){var t,r,e={status:s.status,statusText:s.statusText,headers:(t=s.getAllResponseHeaders()||"",r=new p,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var i=e.join(":").trim();r.append(n,i)}}),r)};e.url="responseURL"in s?s.responseURL:e.headers.get("X-Request-URL");var n="response"in s?s.response:s.responseText;i(new T(n,e))},s.onerror=function(){t(new TypeError("Network request failed"))},s.ontimeout=function(){t(new TypeError("Network request failed"))},s.open(e.method,e.url,!0),"include"===e.credentials?s.withCredentials=!0:"omit"===e.credentials&&(s.withCredentials=!1),"responseType"in s&&o&&(s.responseType="blob"),e.headers.forEach(function(t,e){s.setRequestHeader(e,t)}),s.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function d(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function p(e){this.map={},e instanceof p?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function v(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function g(t){var e=new FileReader,n=v(e);return e.readAsArrayBuffer(t),n}function _(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(o&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(i&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(r&&o&&a(t))this._bodyArrayBuffer=_(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!r||!ArrayBuffer.prototype.isPrototypeOf(t)&&!c(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=_(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var t,e,n,i=y(this);if(i)return i;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=v(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),i=0;i<e.length;i++)n[i]=String.fromCharCode(e[i]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}function b(t,e){var n,i,r=(e=e||{}).body;if(t instanceof b){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new p(t.headers)),this.method=t.method,this.mode=t.mode,r||null==t._bodyInit||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new p(e.headers)),this.method=(n=e.method||this.method||"GET",i=n.toUpperCase(),-1<u.indexOf(i)?i:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function w(t){var r=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),i=e.join("=").replace(/\+/g," ");r.append(decodeURIComponent(n),decodeURIComponent(i))}}),r}function T(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new p(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:this)},function(t,e,n){n(85),t.exports=n(84)}])});